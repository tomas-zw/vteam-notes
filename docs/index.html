<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="sv" xml:lang="sv">
<head>
<!-- 2022-11-22 Tue 09:23 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Elsparkcyklar AB</title>
<meta name="author" content="Tomas Zwolinski, Patrik Malvenius, Joel Löfgren, Richard Sönnerberg" />
<meta name="description" content="SDS utkast" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Elsparkcyklar AB</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Inneh&aring;ll</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org9ad489c">Inledning</a>
<ul>
<li><a href="#org3bc3b5e">Bakgrund</a></li>
<li><a href="#orgbe2e15f">Systemets användare</a></li>
<li><a href="#orgf099551">Systemets delar</a></li>
</ul>
</li>
<li><a href="#orgdd051a6">Användarens app</a></li>
<li><a href="#org4d85e27">Användarens webbgränssnitt</a></li>
<li><a href="#orgf71d916">Administratörsgränssnitt</a>
<ul>
<li><a href="#org8f38709">Översikt och daglig drift</a></li>
<li><a href="#org10ac5b1">Hantering av kunder</a></li>
<li><a href="#org7010b1f">Behörighetshantering</a></li>
<li><a href="#org7c41eb3">Geodatahantering</a></li>
</ul>
</li>
<li><a href="#org936456f">Elsparkcykelns mjukvara</a></li>
<li><a href="#orgd46e336">Backend</a>
<ul>
<li><a href="#orga9e90cb">Backendmodeller</a></li>
<li><a href="#orga2742e9">Databas</a></li>
</ul>
</li>
<li><a href="#orgd80dee5">REST-API</a>
<ul>
<li><a href="#org5b8978f">Substantiv</a></li>
<li><a href="#org24a140b">Verb</a></li>
<li><a href="#org92cdac3">Lista över routes</a></li>
<li><a href="#orgf2076dc">Dokumentation</a></li>
<li><a href="#org8afc836">Versioner</a></li>
<li><a href="#org8cc3e7e">Autentisering</a>
<ul>
<li><a href="#org4a007dd">Godkänd autentisering</a></li>
<li><a href="#org4bee2c3">Misslyckad autentisering</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org308d0b2">Tester</a></li>
<li><a href="#org0f663a1">CI/CD</a></li>
<li><a href="#org6b02525">Simulering</a></li>
<li><a href="#org857db57">Driftsättning</a></li>
<li><a href="#org5217a21">Referenser</a></li>
</ul>
</div>
</div>
<div id="table-of-contents" role="doc-toc">
<h2>Inneh&aring;ll</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org9ad489c">Inledning</a>
<ul>
<li><a href="#org3bc3b5e">Bakgrund</a></li>
<li><a href="#orgbe2e15f">Systemets användare</a></li>
<li><a href="#orgf099551">Systemets delar</a></li>
</ul>
</li>
<li><a href="#orgdd051a6">Användarens app</a></li>
<li><a href="#org4d85e27">Användarens webbgränssnitt</a></li>
<li><a href="#orgf71d916">Administratörsgränssnitt</a>
<ul>
<li><a href="#org8f38709">Översikt och daglig drift</a></li>
<li><a href="#org10ac5b1">Hantering av kunder</a></li>
<li><a href="#org7010b1f">Behörighetshantering</a></li>
<li><a href="#org7c41eb3">Geodatahantering</a></li>
</ul>
</li>
<li><a href="#org936456f">Elsparkcykelns mjukvara</a></li>
<li><a href="#orgd46e336">Backend</a>
<ul>
<li><a href="#orga9e90cb">Backendmodeller</a></li>
<li><a href="#orga2742e9">Databas</a></li>
</ul>
</li>
<li><a href="#orgd80dee5">REST-API</a>
<ul>
<li><a href="#org5b8978f">Substantiv</a></li>
<li><a href="#org24a140b">Verb</a></li>
<li><a href="#org92cdac3">Lista över routes</a></li>
<li><a href="#orgf2076dc">Dokumentation</a></li>
<li><a href="#org8afc836">Versioner</a></li>
<li><a href="#org8cc3e7e">Autentisering</a></li>
</ul>
</li>
<li><a href="#org308d0b2">Tester</a></li>
<li><a href="#org0f663a1">CI/CD</a></li>
<li><a href="#org6b02525">Simulering</a></li>
<li><a href="#org857db57">Driftsättning</a></li>
<li><a href="#org5217a21">Referenser</a></li>
</ul>
</div>
</div>

<div id="outline-container-org9ad489c" class="outline-2">
<h2 id="org9ad489c">Inledning</h2>
<div class="outline-text-2" id="text-org9ad489c">
<p>
I detta dokument beskrivs ett system som hanterar uthyrning av elsparkcyklar. Systemet ger kunder möjlighet att skapa användarkonton och hyra cyklar, administratörer ges möjlighet att administrera cyklar, laddstationer, parkeringsplatser, städer och information om kunder. Systemet innehåller också ett program för cykeln som styr och övervakar denna.
</p>
</div>

<div id="outline-container-org3bc3b5e" class="outline-3">
<h3 id="org3bc3b5e">Bakgrund</h3>
<div class="outline-text-3" id="text-org3bc3b5e">
<p>
Företaget &rdquo;Svenska Elsparkcyklar AB&rdquo; har utryckt ett behov av ett system som kan hantera uthyrning av elsparkcyklar i svenska städer. För närvarande är företaget etablerat och har verksamhet i Örebro, Eskilstuna och Vansbro och planerar att expandera till fler med stöd av ett nytt datasystem.
</p>

<p>
Elsparkcyklar är ett, jämfört med andra fortskaffningsmedel, relativt nytt inslag i vår trafikmiljö. De utgör ett nytt sätt att röra sig och kan med rätt förutsättningar utgöra ett miljövänligt sätt att öka transporteffektiviteten i våra städer. Utmaningarna är dock flera, i en utredning från 2021 påpekar Transportstyrelsen att regelverket kan upplevas som otydligt och att många upplever att de som använder cyklarna inte beter sig korrekt. Transportstyrelsen menar i sin utredning att det framförallt rör sig om att användarna parkerar fel och framför fordonen på ett felaktigt sätt. [1] Sedan 1:a september 2022 får elsparkcyklar inte längre framföras på trottoarer och gångbanor och felparkerade cyklar kan beläggas med avgifter. [2] [3]
</p>

<p>
Vår förhoppning är att det system som vi presenterar här kommer att kunna lösa en del av dessa utmaningar, inte minst genom att uppmuntra användarna till ett korrekt bruk av cyklarna, att t.ex. parkera cykeln på en parkeringsplats kommer innebära lägre kostnader för användaren, och genom att automatiskt begränsa var och med vilken hastighet cyklarna kan köras.
</p>


<div id="org8cfc778" class="figure">
<p><img src="./sds_sammansatt/overblick.svg" alt="overblick.svg" class="org-svg" />
</p>
<p><span class="figure-number">Illustration 1 </span>Översikt av systemet</p>
</div>
</div>
</div>

<div id="outline-container-orgbe2e15f" class="outline-3">
<h3 id="orgbe2e15f">Systemets användare</h3>
<div class="outline-text-3" id="text-orgbe2e15f">
<p>
Systemets huvudsakliga användare är kunder (benämns härefter som användare) och administratörer.
</p>

<p>
Användare har möjlighet att hyra en cykel via en mobilapplikation som också visar status för senaste resan och en historik över gjorda resor. Användare har också tillgång till ett webbgränssnitt där de kan se sina kontodetaljer och en historik över sin användning och betalningar.
</p>

<p>
Administratörer har möjlighet att via ett webbgränssnitt se status på cyklar och stationer samt få information om kunder. Administratörer kan också lägga till nya cyklar, laddstationer, zoner för parkering, zoner med särskilda regler och städer.
</p>
</div>
</div>

<div id="outline-container-orgf099551" class="outline-3">
<h3 id="orgf099551">Systemets delar</h3>
<div class="outline-text-3" id="text-orgf099551">
<p>
Systemet omfattar följande huvudsakliga komponenter:
</p>

<ul class="org-ul">
<li>Databas med information om cyklar, laddstationer, parkeringszoner, tillåtna zoner att cykla i, användare och administratörer</li>

<li>Backend - en komponent som sköter kopplingen mellan API och databas</li>

<li>API med möjlighet att koppla in anpassade applikationer, grundsystemet levereras med följande applikationer:

<ul class="org-ul">
<li>Administrativt webbgränssnitt där man kan se status för och administrera (ändra, ta bort och lägga till) cyklar, laddstationer, parkeringsplatser, städer och information om kunder</li>

<li>Webbgränssnitt för kunden så att denne kan logga in och se sitt konto, historik av utlåning och betalningar</li>

<li>Mobilanpassad webbapp för kunden så denne kan se låna/lämna tillbaka cykeln samt se status på senaste resan och historik över gjorda resor</li>

<li>Ett cykelprogram som styr och övervakar cykeln (på, av, hastighet, begränsa hastighet, position, behöver service/laddning)</li>
</ul></li>
</ul>

<p>
Samtliga applikationer som kopplas mot API:et måste autentisera sin anslutning
</p>

<p>
Nedanstående diagram visar en översikt över systemets huvudkomponenter samt hur de relaterar till- och kommunicerar med varandra i olika lager.[4]
</p>


<div id="orgf663f89" class="figure">
<p><img src="./sds_sammansatt/komponenter_översikt.png" alt="komponenter_översikt.png" />
</p>
<p><span class="figure-number">Illustration 2 </span>Översikt över systemets huvudkomponenter</p>
</div>

<p>
I följande avsnitt beskriver vi systemets olika delar i detalj.
</p>
</div>
</div>
</div>

<div id="outline-container-orgdd051a6" class="outline-2">
<h2 id="orgdd051a6">Användarens app</h2>
<div class="outline-text-2" id="text-orgdd051a6">

<div id="orgf527014" class="figure">
<p><img src="./sds_sammansatt/mobile_-_home.png" alt="mobile_-_home.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>Hemskärm i mobilapp</p>
</div>

<p>
I användarens app kan en användare hyra och återlämna elsparkcyklar. Appen är mobilanpassad och byggs med hjälp av JavaScript-biblioteket React. Med React finns möjlighet att bygga upp ett användargränssnitt genom att skriva enskilda komponenter som kopplas samman till ett sammanhängande UI. React  kräver inte att man använder någon viss teknologi i resten av systemet och är därför ett bra val för att bygga användargränssnitt i ett modulärt system, där delar ska kunna bytas ut eller läggas till efter behov. Det finns också möjlighet att bygga mobila &rdquo;native&rdquo;-applikationer med hjälp av React Native.[5] 
</p>

<p>
Elsparkcyklar som är registrerade i systemet för uthyrning och inte upptagna eller under service kan av en användare väljas för uthyrning via appen. För att kunna hyra en elsparkcykel måste användaren autentisera och identifiera sig, detta görs via OAuth med hjälp av ett GitHub konto. När användaren loggar in i appen visas en kartbild med tillgängliga elsparkcyklar, laddstationer och rekommenderade parkeringsplatser. I vårt program identifieras en elsparkcykel genom att från kartbilden välja elsparcykelns ikon vilket ger användaren möjligheten att välja vald elsparkcykel för uthyrning.
</p>

<p>
Då en uthyrning påbörjats så låses cykeln upp och användaren kan manövrera elsparkcykeln under hyrtiden.
</p>

<p>
Användaren kan också, via appen, få information från den hyrda elsparkcykeln i form av:
</p>

<ul class="org-ul">
<li>batterinivå</li>
<li>behov av service (med anledning av t.ex. punktering, trasiga lampor eller dåliga bromsar)</li>
</ul>

<p>
Då användaren avslutar sin sin resa och återlämnar elsparkcykeln så debiteras användarens konto automatiskt för färden. Färdens kostnad kan variera beroende på:
</p>

<ul class="org-ul">
<li>hur lång hyrestiden är</li>
<li>om cykeln flyttats från fri parkering (valfri parkeringsplats utanför rekommenderade parkeringszoner) till en mer önskvärd parkeringsplats</li>
<li>om cykeln parkeras genom fri parkering</li>
</ul>

<p>
När färden avslutats låses cykeln igen.
</p>

<p>
Denna bild ger en översikt över flödet för att hyra en elsparkcykel i användarens mobilapp, runda cirklar visar kommandon som utförs i backend.
</p>


<div id="orgce08409" class="figure">
<p><img src="./sds_sammansatt/användarens_app.drawio.png" alt="användarens_app.drawio.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>flödet i användarens app vid uthyrning av elsparkcykel.</p>
</div>

<p>
[4] Se <a href="https://reactjs.org/">https://reactjs.org/</a>
</p>
</div>
</div>

<div id="outline-container-org4d85e27" class="outline-2">
<h2 id="org4d85e27">Användarens webbgränssnitt</h2>
<div class="outline-text-2" id="text-org4d85e27">

<div id="org874684c" class="figure">
<p><img src="./sds_sammansatt/desktop_-_home.png" alt="desktop_-_home.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>Hemskärm i webbläsare för dator</p>
</div>


<p>
Denna del av systemet är en desktop-app som, liksom användarens mobilapp, byggs i React. I användarens webbgränssnitt kan en användare logga in för att se och ändra detaljer om sitt konto. Användaren skapar ett konto och loggar in via OAuth med hjälp av sitt Githubkonto.
</p>


<p>
Det är också möjigt att skapa ett konto på sedvanligt vis genom att uppge:
</p>

<ul class="org-ul">
<li>förnamn</li>
<li>efternamn</li>
<li>adress</li>
<li>faktureringsadress</li>
<li>användarnamn</li>
<li>lösenord</li>
</ul>

<p>
När användaren loggar in har denne möjlighet att ändra detaljer angående kontot eller radera det.
</p>

<p>
Användaren kan i webbgränssnitttet också se detaljer om sina resor som innefattar:
</p>

<ul class="org-ul">
<li>ID på resan</li>
<li>Startdatum</li>
<li>Starttid</li>
<li>Slutdatum</li>
<li>Sluttid</li>
<li>Startpunkt</li>
<li>Slutpunkt</li>
<li>Kostnad för resan</li>
</ul>

<p>
Slutligen kan användaren då denne loggat in på sitt konto också se och fylla på det saldo som används för att bekosta resor med elsparkcykel. Alternativt kan användaren koppla sig till och betala via en betalningstjänst, i så fall dras en avgift varje månad.
</p>

<p>
Nedanstående diagram visar flödet i användarens webbgränssnitt:
</p>


<div id="org1e9f403" class="figure">
<p><img src="./sds_sammansatt/användarens_webbgränssnitt.drawio.png" alt="användarens_webbgränssnitt.drawio.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>Flödet i användarens webbgränssnitt</p>
</div>
</div>
</div>

<div id="outline-container-orgf71d916" class="outline-2">
<h2 id="orgf71d916">Administratörsgränssnitt</h2>
<div class="outline-text-2" id="text-orgf71d916">
<p>
Administratörsgränssnittet byggs i React - ett JavaScript bibliotek för att skapa användargränssnitt.[5] JavaScript-biblioteket Leaflet används för att skapa och hantera kartor och geodata.
</p>

<p>
Systemets administratörsgränssnitt används av behöriga användare för att få en översikt över företagets alla resurser:
</p>

<ul class="org-ul">
<li>Kunder</li>
<li>Städer man är verksam i</li>
<li>Cyklar</li>
<li>Laddstationer</li>
<li>Parkeringsplatser</li>
<li>Områden med särskilda bestämmelser</li>
</ul>

<p>
Administratörsgränssnitt innehåller vyer för att inspektera resurser, skicka kommandon till enskilda cyklar, hantera kundinformation, hantera behörigheter, samt uppdatera systemet med ny data, t ex nya städer man etablerar sig i, nya cyklar, nya parkeringsplatser etc.
</p>
</div>

<div id="outline-container-org8f38709" class="outline-3">
<h3 id="org8f38709">Översikt och daglig drift</h3>
<div class="outline-text-3" id="text-org8f38709">
<p>
I vyn för översikt och daglig drift presenteras all information kring cyklar, laddstationer, parkeringsplatser och områden med särskilda bestämmelser för varje stad man verkar i. Vyn är kartcentrerad. I kartan kan man se information om aktuell status för alla tillgängliga resurser i vald stad, samt även filtrera kartvyn baserat på resursers typ, identitet eller status. Denna vy används också för att skicka manuella driftkommandon till enskilda cyklar. Det kan t ex  vara ett kommando för att stoppa cykeln, om administratören ser behov av det.
</p>


<div id="org0b04622" class="figure">
<p><img src="./sds_sammansatt/admin_oversikt.drawio.png" alt="admin_oversikt.drawio.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>Översiktsvy från systemet</p>
</div>
</div>
</div>

<div id="outline-container-org10ac5b1" class="outline-3">
<h3 id="org10ac5b1">Hantering av kunder</h3>
<div class="outline-text-3" id="text-org10ac5b1">
<p>
Kundvyn är en klassisk listvy. Här kan man se en lista på alla företagets kunder, som kan filtreras på stad, användarnamn, antal gjorda resor m m. I denna vyn kan administratören också uppdatera information om enskilda kunder, t ex för att ge en kund en generell rabatt eller rabatt för en enskild resa. Administratören kan också skapa upp nya kunder i denna vy, även om detta i normalfallet hanteras av kunden själv.
</p>


<div id="orge410fb6" class="figure">
<p><img src="./sds_sammansatt/admin_kundvy.drawio.png" alt="admin_kundvy.drawio.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>Kundvy från systemet</p>
</div>
</div>
</div>

<div id="outline-container-org7010b1f" class="outline-3">
<h3 id="org7010b1f">Behörighetshantering</h3>
<div class="outline-text-3" id="text-org7010b1f">
<p>
Vyn för behörighetshantering används för att skapa användare och tilldela dessa behörigheter i administratörssystemet. Huvudadministratören anges vid konfiguration av systemet, men alla övriga roller hanteras i detta gränssnitt.
</p>


<div id="org941d962" class="figure">
<p><img src="./sds_sammansatt/admin_behorighet.drawio.png" alt="admin_behorighet.drawio.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>Behörighetsvy från systemet</p>
</div>
</div>
</div>

<div id="outline-container-org7c41eb3" class="outline-3">
<h3 id="org7c41eb3">Geodatahantering</h3>
<div class="outline-text-3" id="text-org7c41eb3">
<p>
Systemet har kraftfulla och lättanvända funktioner för att hantera nya marknader och nya resurser. I vyn för geodatahantering kan administratören lägga till nya städer för företaget, samt skapa, uppdatera och radera information om enskilda resurser.
</p>


<div id="orga28f929" class="figure">
<p><img src="./sds_sammansatt/admin_kartred.drawio.png" alt="admin_kartred.drawio.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>Kartredigeringsvy från systemet</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org936456f" class="outline-2">
<h2 id="org936456f">Elsparkcykelns mjukvara</h2>
<div class="outline-text-2" id="text-org936456f">

<div id="org75b25a1" class="figure">
<p><img src="./sds_sammansatt/cykelkommunikation.svg" alt="cykelkommunikation.svg" class="org-svg" />
</p>
</div>

<p>
En elsparkcykels huvudsakliga uppgift är att hela tiden meddela sin positon och hälsa via API&amp;rsquo;et. Elsparkcykelns mjukvara byggs i Python, då det i detta programspråk finns många färdiga bibliotek för att hantera integration med sensorer o dyl.
</p>

<p>
Elsparkcykelns har sensorer som samlar in information som rör dess egen position samt funktionsstatus:
</p>

<ul class="org-ul">
<li>Batterinivån är låg</li>
<li>En lampa har gått sönder</li>
<li>Punktering</li>
</ul>

<p>
Dessa statusindikatorer skickas till backend. Backend matar i sin tur elsparkcykeln med information som rör dess omgivning:
</p>

<ul class="org-ul">
<li>Uthyrd till en användare</li>
<li>Användare avslutar hyran</li>
<li>Begränsa hastighet när den befinner sig i specifika zoner</li>
<li>Stoppa elsparkcykeln ifall den är utanför tillåtet område.</li>
<li>Intagen på service</li>
<li>Service utförd</li>
</ul>

<p>
Det är endast när elsparkcykelns status har blivit ändrad till &amp;rdquo;uthyrd&amp;rdquo; eller på &amp;rdquo;service som
elsparkcykeln är upplåst och går att köra. Så fort dess status återvänder till &amp;rdquo;ledig&amp;rdquo; så
stängs den av och bromsas, och det enda sättat att flytta den är då att fysiskt lyfta upp och bära bort den.
Blir det rörelse på en elsparkcykel som ej är uthyrd skickas då en varning omgående till backend,
och sedan med ett tätt intervall tills den återigen står stilla. Detta möjliggör att personal kan hitta eventuellt stulna
elsparkcykelar.
</p>

<p>
Tusentals elsparkcyklar finns i systemet. För att minimera belastningen på API och backend så
uppdaterar dom sin position med olika intervall beroende på olika faktorer.
</p>

<ul class="org-ul">
<li>En uthyrd elsparkcykel i rörelse skickar positionsdata ofta</li>
<li>En ledig och stillastående elsparkcykel skickar positionsdata sällan</li>
<li>En elsparkcykel på laddning eller service skickar positionsdata sällan</li>
</ul>

<p>
Vae elsparkcykel sparar också en egen historik över alla sina resor.
</p>

<ul class="org-ul">
<li>Resans användare</li>
<li>Resans startposition samt klockslag</li>
<li>Resans slutposition samt klockslag</li>
</ul>
</div>
</div>

<div id="outline-container-orgd46e336" class="outline-2">
<h2 id="orgd46e336">Backend</h2>
<div class="outline-text-2" id="text-orgd46e336">
<p>
De grundläggande kraven för systemets backend är:
</p>

<ul class="org-ul">
<li>Databasen skall kunna hantera relevant data.</li>
<li>Systemet skall erbjuda ett väldokumenterat REST API som tredjepartsleverantörer kan använda för att bygga extra tjänster och applikationer.</li>
<li>REST API:et skall kunna hantera flera olika versioner, t ex genom att använda v1/ som en del i ~~URI~~URL:n.</li>
<li>REST API:et skall hantera autentisering så man kan kontrollera/begränsa belastningen som varje applikation ger.</li>
</ul>

<p>
Med underlag av data från tester med MongoDB och MariaDB, där respektive databas belastades med en stor mängd anrop under kort tid,
valdes MariaDB som databas för att hantera all data. [6]
Samma tester visade också på stora skillnader i prestanda mellan en FastAPI (Python) och Express (node) server, där Express
visade sig vara det bättre valet.
Städernas geodata fås från Open Street Map. Det är ett fritt bibliotek som erbjuder den data som behövs. [9]
</p>

<p>
Kommunikation mellan klienter och backend sker via API:t och där klinten enbart känner till sin egen data och
backend har data över alla delar i systemet.
Några exempel på kommunikationen är:
</p>


<div id="org7fa3c62" class="figure">
<p><img src="./sds_sammansatt/backend_example.png" alt="backend_example.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>Några övergripande exempel på kommunikationen</p>
</div>
</div>

<div id="outline-container-orga9e90cb" class="outline-3">
<h3 id="orga9e90cb">Backendmodeller</h3>
<div class="outline-text-3" id="text-orga9e90cb">
<p>
I backend ingår ett lager med modeller som sköter kommunikationen mellan api och databas, alltså skickar in SQL-frågor till databasen och tar emot svar. I dessa modeller genomförs också olika beräkningar. Det kan tex handla om att beräkna kostnaden för en resa, eller beräkna om en cykel befinner sig inom en viss zon. För att göra de nödvändiga geografiska beräkningarna använder vi oss av geodatabibliotek som underlättar detta. Efter att ha undersökt olika bibliotek både för Python och JS kom vi fram till att JS biblioteken tycks vara mer lättanvända.[7] Vi kommer därför använda oss av TurfJS, ett bibliotek som som har flera funktioner som kommer att underlätta för oss att beräkna cyklarnas positioner och göra backendmodellerna effektivare.[7] [8]
</p>
</div>
</div>

<div id="outline-container-orga2742e9" class="outline-3">
<h3 id="orga2742e9">Databas</h3>
<div class="outline-text-3" id="text-orga2742e9">
<p>
Information systemets olika entiteter samlas i en databas. En entitet kan t.ex. vara &rdquo;användare&rdquo;, &rdquo;stad&rdquo; eller &rdquo;administratör&rdquo;. I detta avsnitt beskrivs vilka entiteter som finns i databasen, vilka egenskaper de har och hur entiteterna relaterar till varandra.  
Databasen som används är MariaDB. Det är en open source relations-databas. Den är baserad på MySQL databasen och använder traditionell SQL syntax.  
</p>

<p>
De fyra entiteter som utgör grunden för databasen är:
</p>


<div id="org533f422" class="figure">
<p><img src="./sds_sammansatt/databas-mjuk.png" alt="databas-mjuk.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>De fyra huvudsakliga entiteterna</p>
</div>

<p>
Tabeller vars data är en produkt av olika händelser uppdateras med data från någon av de fyra entiteterna. tex när en användare hyr en elsparkcykel så startas en resa.
</p>
<ul class="org-ul">
<li>Vilken användare hyrde</li>
<li>Vilken elsparkcykel som hyrdes</li>
<li>Elsparkcykelns position när hyran startades</li>
<li>Elsparkcykelns position när hyran avslutades</li>
</ul>

<p>
Denna resa utgör i sin tur underlaget för en faktura.
</p>
<ul class="org-ul">
<li>Stadens taxa</li>
<li>Eventuell rabatt om resan avslutades i en parkeringszon</li>
</ul>

<p>
Nedanstående bild visar samtliga entiteter som förekommer i databasen, deras attribut och inbördes relationer.
</p>


<div id="org06aefcf" class="figure">
<p><img src="./sds_sammansatt/databas-er.png" alt="databas-er.png" />
</p>
<p><span class="figure-number">Illustration 1 </span>ER-diagram</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd80dee5" class="outline-2">
<h2 id="orgd80dee5">REST-API</h2>
<div class="outline-text-2" id="text-orgd80dee5">
<p>
Systemets applikationer använder ett REST-API för att kommunicera med systemets backend. För att veta vilka routes vi behöver ha i REST-API:et så har följande substantiv identifierats (dessa stämmer överens med entiteterna i databasen):
</p>
</div>

<div id="outline-container-org5b8978f" class="outline-3">
<h3 id="org5b8978f">Substantiv</h3>
<div class="outline-text-3" id="text-org5b8978f">
<ul class="org-ul">
<li>Användare</li>
<li>Administratör</li>
<li>Huvudadministratör</li>
<li>Elsparkcykel</li>
<li>Laddstation</li>
<li>Stad</li>
<li>Förbjuden zon</li>
<li>Verkstad</li>
</ul>
</div>
</div>

<div id="outline-container-org24a140b" class="outline-3">
<h3 id="org24a140b">Verb</h3>
<div class="outline-text-3" id="text-org24a140b">
<p>
De identifierade substantiven behöver också utföra handlingar, därav följande verblista:
</p>

<ul class="org-ul">
<li>En användare ska hyra en elsparkcykel</li>
<li>En användare ska registrera ett konto</li>
<li>En användare ska logga in på sitt konto</li>
<li>En användare ska lämna tillbaka en elsparkcykel</li>
<li>En administratör ska registrera ett konto</li>
<li>En administratör ska logga in på sitt konto</li>
<li>En huvudadministratör ska registera en administratör</li>
<li>En elsparkcykel ska köra</li>
<li>En laddstation ska innehålla elsparkcyklar</li>
<li>En stad ska innehålla elsparkcyklar, zoner etc.</li>
<li>En verkstad ska kunna utföra service på elsparkcyklar</li>
</ul>
</div>
</div>

<div id="outline-container-org92cdac3" class="outline-3">
<h3 id="org92cdac3">Lista över routes</h3>
<div class="outline-text-3" id="text-org92cdac3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">`URL`</th>
<th scope="col" class="org-left">`GET`</th>
<th scope="col" class="org-left">`POST`</th>
<th scope="col" class="org-left">`PUT`</th>
<th scope="col" class="org-left">`DELETE`</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">/users</td>
<td class="org-left">Visa alla användare</td>
<td class="org-left">Skapa en ny användare</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/users/{id}</td>
<td class="org-left">Visa en användare med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en användare med id {id}</td>
<td class="org-left">Ta bort en användare med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/users/{id}/position</td>
<td class="org-left">Visa positionen för en användare med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">^</td>
</tr>

<tr>
<td class="org-left">/users/{city}</td>
<td class="org-left">Visa alla användare som för tillfället hyr en elsparkcykel i stad {city}</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/users/online</td>
<td class="org-left">Visa alla användare som för tillfället är online</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/users/offline</td>
<td class="org-left">Visa alla användare som för tillfället är offline</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/administrators</td>
<td class="org-left">Visa alla administratörer</td>
<td class="org-left">Skapa en ny administratör</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/administrators/{id}</td>
<td class="org-left">Visa en administratörer med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en administratör med id {id}</td>
<td class="org-left">Ta bort en administratör med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/mainAdministrators</td>
<td class="org-left">Visa alla huvudadministratör</td>
<td class="org-left">Skapa en ny huvudadministratör</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/mainAdministrators/{id}</td>
<td class="org-left">Visa en huvudadministratör med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en huvudadministratör med id {id}</td>
<td class="org-left">Ta bort en huvudadministratör med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/cities</td>
<td class="org-left">Visa alla städer</td>
<td class="org-left">Skapa en ny stad</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/cities/{id}</td>
<td class="org-left">Visa en stad med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en stad med id {id}</td>
<td class="org-left">Ta bort en stad med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/cities/{id}/forbiddenZones</td>
<td class="org-left">Visa alla förbjudna zoner i stad med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/cities/{id}/electricScooters</td>
<td class="org-left">Visa alla elsparkcyklar i stad med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/cities/{id}/chargingStations</td>
<td class="org-left">Visa alla laddstationer i stad med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/cities/{id}/workshops</td>
<td class="org-left">Visa alla verkstäder i stad med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/electricScooters</td>
<td class="org-left">Visa alla elsparkcyklar</td>
<td class="org-left">Skapa en ny elsparkcykel</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/electricScooters/rented</td>
<td class="org-left">Visa alla elsparkcyklar som just nu är uthyrda</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/electricScooters/stale</td>
<td class="org-left">Visa alla elsparkcyklar som just nu inte är uthyrda</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/electricScooters/serviced</td>
<td class="org-left">Visa alla elsparkcyklar som just nu är under service</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/electricScooters/{id}</td>
<td class="org-left">Visa en elsparkcykel med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en elsparkcykel med id {id}</td>
<td class="org-left">Ta bort en elsparkcykel med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/electricScooters/{id}/position</td>
<td class="org-left">Visa positionen för en elsparkcykel med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/electricScooters/{id}/batteryLevel</td>
<td class="org-left">Visa batterinivån för en elsparkcykel med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/electricScooters/{id}/stop</td>
<td class="org-left">:x:</td>
<td class="org-left">Stoppa elsparkcykeln</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/chargingStations</td>
<td class="org-left">Visa alla laddstationer</td>
<td class="org-left">Skapa en ny laddstation</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/chargingStations/{id}</td>
<td class="org-left">Visa en laddstation med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en elsparkcykel med id {id}</td>
<td class="org-left">Ta bort en elsparkcykel med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/forbiddenZones</td>
<td class="org-left">Visa alla förbjudna zoner</td>
<td class="org-left">Skapa en ny förbjuden zon</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/forbiddenZones/{id}</td>
<td class="org-left">Visa en förbjuden zon med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en förbjuden zon med id {id}</td>
<td class="org-left">Ta bort en förbjuden zon med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/workshops</td>
<td class="org-left">Visa alla verkstäder</td>
<td class="org-left">Skapa en ny verkstad</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/workshops/{id}</td>
<td class="org-left">Visa en verkstad med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en verkstad med id {id}</td>
<td class="org-left">Ta bort en verkstad med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/parkingZones</td>
<td class="org-left">Visa en alla parkeringplatser</td>
<td class="org-left">Skapa en ny parkeringsplats</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/parkingZones/{id}</td>
<td class="org-left">Visa en parkeringplats med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en parkeringsplats med id {id}</td>
<td class="org-left">Ta bort en parkeringsplats med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/trips</td>
<td class="org-left">Visa alla resor</td>
<td class="org-left">Skapa en ny resa</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/trips/{id}</td>
<td class="org-left">Visa en resa med id {id}</td>
<td class="org-left">:x:</td>
<td class="org-left">Modifiera en resa med id {id}</td>
<td class="org-left">Ta bort en resa med id {id}</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">/trips/{userId}</td>
<td class="org-left">Visa alla resor med användar-id {användar-id}</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">:x:</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgf2076dc" class="outline-3">
<h3 id="orgf2076dc">Dokumentation</h3>
<div class="outline-text-3" id="text-orgf2076dc">
<p>
För att underlätta för tredjepartsleverntörer att bygga externa tjänster och applicationer är
REST-API&amp;rsquo;et väldokumenterat.
</p>

<ul class="org-ul">
<li>Länk till dokumentationen?</li>
<li>Ett exempel från dokumentationen på en enskild endpoint?</li>
</ul>
</div>
</div>

<div id="outline-container-org8afc836" class="outline-3">
<h3 id="org8afc836">Versioner</h3>
<div class="outline-text-3" id="text-org8afc836">
<p>
REST-API&amp;rsquo;et har byggts för att vara framtidssäkert där uppdateringar och tillägg hanteras med
versionsnummer som en del i ~~URI~~URL:en.
</p>
</div>
</div>

<div id="outline-container-org8cc3e7e" class="outline-3">
<h3 id="org8cc3e7e">Autentisering</h3>
<div class="outline-text-3" id="text-org8cc3e7e">
<p>
Alla applikationer som använder REST-API&amp;rsquo;et måste autentisera sig med hjälp av JSON Web Tokens för att kontrollera att endast
endpoints som rör applikationen finns tillgängliga.
</p>
</div>

<div id="outline-container-org4a007dd" class="outline-4">
<h4 id="org4a007dd">Godkänd autentisering</h4>
<div class="outline-text-4" id="text-org4a007dd">
<p>
En applikation för administratörer kan se alla användare i systemet.
</p>

<div class="org-src-container">
<pre class="src src-json">
    GET ../v1/users/

    {
        "data": [
            {
                "id": 1,
                "name": "John Doe",
                ...
            },
            {
                "id": 2,
                "name": "Jane Doe",
                ...
            }
        ]
    }
</pre>
</div>
</div>
</div>

<div id="outline-container-org4bee2c3" class="outline-4">
<h4 id="org4bee2c3">Misslyckad autentisering</h4>
<div class="outline-text-4" id="text-org4bee2c3">
<p>
En applikation för användare kan <b><b>inte</b></b> se alla användare i systemet.
</p>

<div class="org-src-container">
<pre class="src src-json">    GET ../v1/users/

    {
        "errors": {
            "status": 401,
            "source": "/users",
            "title": "Authorization failed",
            "detail": "No valid API key provided."
        }
    }
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org308d0b2" class="outline-2">
<h2 id="org308d0b2">Tester</h2>
<div class="outline-text-2" id="text-org308d0b2">
<p>
Alla i systemet ingående komponenter kommer under utvecklingen av systemets genomgå unit- och integrationstester
</p>
</div>
</div>

<div id="outline-container-org0f663a1" class="outline-2">
<h2 id="org0f663a1">CI/CD</h2>
<div class="outline-text-2" id="text-org0f663a1">
<p>
För att säkerställa att alla tester körs som de ska, och att ingen ny kod skapas som bryter beteendet i befintlig kod, bygger vi ett flöde för CI/CD i GitHub.
</p>
</div>
</div>

<div id="outline-container-org6b02525" class="outline-2">
<h2 id="org6b02525">Simulering</h2>
<div class="outline-text-2" id="text-org6b02525">
<p>
Innan systemet färdigställs för slutleverans kommer systemet utsättas för ett virtuellt stresstest. I detta test simulerar vi  5000 cyklar som hyrs ut, framförs, och återlämnas i vardera stad systemet skall användas i. Resultatet av denna simulering sammanställs och infogas i leveransrapporten.
</p>
</div>
</div>

<div id="outline-container-org857db57" class="outline-2">
<h2 id="org857db57">Driftsättning</h2>
<div class="outline-text-2" id="text-org857db57">
<p>
Systemet kan driftas i valfri miljö då vi redan vid utvecklingen implementerar containerization genom Docker. 
</p>
</div>
</div>

<div id="outline-container-org5217a21" class="outline-2">
<h2 id="org5217a21">Referenser</h2>
<div class="outline-text-2" id="text-org5217a21">
<p>
[1] Transportstyrelsen. &rdquo;Utredning behov av förenklade regler för eldrivna enpersonsfordon&rdquo;. Internet: <a href="https://www.transportstyrelsen.se/globalassets/global/publikationer-och-rapporter/vag/slutrapport-utredning-regler-eldrivna-enpersonsfordon.pdf">https://www.transportstyrelsen.se/globalassets/global/publikationer-och-rapporter/vag/slutrapport-utredning-regler-eldrivna-enpersonsfordon.pdf</a> <span class="timestamp-wrapper"><span class="timestamp">[2022-11-18 Fri]</span></span>.
</p>

<p>
[2] M. Eskilsson. &rdquo;Även för elsparkcyklister är reglerna en bra utveckling&rdquo;. Jönköpingsposten (Sep. 3, 2022), Ledare s. 2.
</p>

<p>
[3] &rdquo;Trafikförordning (1998:1276)&rdquo;. Internet: <a href="https://rkrattsbaser.gov.se/sfst?bet=1998:1276">https://rkrattsbaser.gov.se/sfst?bet=1998:1276</a> <span class="timestamp-wrapper"><span class="timestamp">[2022-11-18 Fri]</span></span>.
</p>

<p>
[4] M. Richards. &rdquo;Software architecture patterns&rdquo;. Internet: <a href="https://www.oreilly.com/content/software-architecture-patterns/">https://www.oreilly.com/content/software-architecture-patterns/</a> <span class="timestamp-wrapper"><span class="timestamp">[2022-11-18 Fri]</span></span>.
</p>

<p>
[5] &rdquo;React&rdquo;. Internet: <a href="https://reactjs.org/">https://reactjs.org/</a> <span class="timestamp-wrapper"><span class="timestamp">[2022-11-19 Sat]</span></span>
</p>

<p>
[6] &rdquo;Requests/sek&rdquo;. Internet: <a href="https://github.com/virtuella-team/vteam/tree/tzLocal">https://github.com/virtuella-team/vteam/tree/tzLocal</a> <span class="timestamp-wrapper"><span class="timestamp">[2022-11-19 Sat]</span></span>
</p>

<p>
[7] &rdquo;Hantering av geodata i databas/backend&rdquo;. Internet: <a href="https://github.com/virtuella-team/vteam-sds/blob/main/8_teknisk_analys_geo/teknisk_analys_geo.md">https://github.com/virtuella-team/vteam-sds/blob/main/8_teknisk_analys_geo/teknisk_analys_geo.md</a> <span class="timestamp-wrapper"><span class="timestamp">[2022-11-19 Sat]</span></span>.
</p>

<p>
[8] &rdquo;Turf.js&rdquo;. Internet: <a href="https://turfjs.org/">https://turfjs.org/</a> <span class="timestamp-wrapper"><span class="timestamp">[2022-11-19 Sat]</span></span>.
</p>

<p>
[9] &rdquo;Open Street Map&rdquo; . <a href="https://www.openstreetmap.org/*map=5/62.994/17.637">https://www.openstreetmap.org/*map=5/62.994/17.637</a> <span class="timestamp-wrapper"><span class="timestamp">[2022-11-19 Sat]</span></span>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">F&ouml;rfattare: Tomas Zwolinski, Patrik Malvenius, Joel Löfgren, Richard Sönnerberg</p>
<p class="date">Created: 2022-11-22 Tue 09:23</p>
</div>
</body>
</html>